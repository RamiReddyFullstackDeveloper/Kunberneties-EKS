#!/bin/bash

#Google Kubernets Engine GKE
Note: Follow the  below official website how to create the cluster in gke and etc
#https://cloud.google.com/kubernetes-engine/docs/deploy-app-cluster 

#Before you begin
Take the following steps to enable the Kubernetes Engine API:
1> In the Google Cloud console, on the project selector page, select or create a Google Cloud project.

Note: If you dont plan to keep the resources that you create in this procedure, create a project instead of selecting an existing project. After you finish these steps, you can delete the project, removing all resources associated with the project.

2> Make sure that billing is enabled for your Google Cloud project. Learn how to check if billing is enabled on a project.

3> Enable the Artifact Registry and Google Kubernetes Engine APIs.

#Launch Cloud Shell
In this tutorial you will use Cloud Shell, which is a shell environment for managing resources hosted on Google Cloud.

Cloud Shell comes preinstalled with the Google Cloud CLI and kubectl command-line tool. The gcloud CLI provides the primary command-line interface for Google Cloud, and kubectl provides the primary command-line interface for running commands against Kubernetes clusters.

Launch Cloud Shell:

Go to the Google Cloud console.

Google Cloud console

From the upper-right corner of the console, click the Activate Cloud Shell button: 

A Cloud Shell session opens inside a frame lower on the console. You use this shell to run gcloud and kubectl commands. Before you run commands, set your default project in the Google Cloud CLI using the following command:
$ gcloud config set project PROJECT_ID  #Replace PROJECT_ID with your project ID.

#Create a GKE cluster
A cluster consists of at least one cluster control plane machine and multiple worker machines called nodes. Nodes are Compute Engine virtual machine (VM) instances that run the Kubernetes processes necessary to make them part of the cluster. You deploy applications to clusters, and the applications run on the nodes.

Create an Autopilot cluster named hello-cluster:

$gcloud container clusters create-auto hello-cluster \
    --region=COMPUTE_REGION

$Replace COMPUTE_REGION with your Compute Engine region, such as us-west1.

Note: It might take several minutes to finish creating the cluster.

#Get authentication credentials for the cluster
After creating your cluster, you need to get authentication credentials to interact with the cluster:

$gcloud container clusters get-credentials hello-cluster \
    --region COMPUTE_REGION
	
#Deploy an application to the cluster
Now that you have created a cluster, you can deploy a containerized application to it. For this quickstart, you can deploy our example web application, hello-app.

GKE uses Kubernetes objects to create and manage your clusters resources. Kubernetes provides the Deployment object for deploying stateless applications like web servers. Service objects define rules and load balancing for accessing your application from the internet.

#Create the Deployment	
To run hello-app in your cluster, you need to deploy the application by running the following command:

$kubectl create deployment hello-server \
    --image=us-docker.pkg.dev/google-samples/containers/gke/hello-app:1.0
	
#Expose the Deployment
After deploying the application, you need to expose it to the internet so that users can access it. You can expose your application by creating a Service, a Kubernetes resource that exposes your application to external traffic.

To expose your application, run the following kubectl expose command:

$kubectl expose deployment hello-server --type LoadBalancer --port 80 --target-port 8080

Passing in the --type LoadBalancer flag creates a Compute Engine load balancer for your container. The --port flag initializes public port 80 to the internet and the --target-port flag routes the traffic to port 8080 of the application.

Load balancers are billed per Compute Engines load balancer pricing.

#Inspect and view the application
1> Inspect the running Pods by using kubectl get pods:

$ kubectl get pods
You should see one hello-server Pod running on your cluster.

2>  Inspect the hello-server Service by using kubectl get service:

$ kubectl get service hello-server
From this commands output, copy the Services external IP address from the EXTERNAL-IP column.

3> View the application from your web browser by using the external IP address with the exposed port:
$ http://EXTERNAL_IP

#Clean up
To avoid incurring charges to your Google Cloud account for the resources used on this page, follow these steps.
1> Delete the applications Service by running kubectl delete:
$ kubectl delete service hello-server

2> This command deletes the Compute Engine load balancer that you created when you exposed the Deployment.

 Delete your cluster by running gcloud container clusters delete:
$gcloud container clusters delete hello-cluster   --region COMPUTE_REGION


#Code Review to see pls follow the below link

https://cloud.google.com/kubernetes-engine/docs/deploy-app-cluster#dockerfile

